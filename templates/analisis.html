    {% extends "layout.html" %}

{% block title %}Analisis - Penderita DM Jawa Barat{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-3xl font-bold">Analisis Data</h1>
    <p class="text-secondary">Analisis detail penderita diabetes melitus di Jawa Barat</p>
</div>

<!-- Grid for analysis cards -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

    <!-- Analisis 14: Total Penderita DM per Tahun -->
    <div class="card lg:col-span-2">
        <h3 class="chart-title">14. Total Penderita DM per Tahun</h3>
        <p class="text-secondary mb-4">Total jumlah penderita diabetes melitus per tahun di seluruh Jawa Barat.</p>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Tahun</th>
                        <th>Jumlah Penderita</th>
                        <th>Perubahan</th>
                    </tr>
                </thead>
                <tbody>
                    {% set prev_value = 0 %}
                    {% for tahun, jumlah in total_per_tahun.items()|sort %}
                    <tr>
                        <td class="font-semibold">{{ tahun }}</td>
                        <td>{{ "{:,}".format(jumlah|int) }}</td>
                        <td>
                            {% if prev_value > 0 %}
                                {% set change = ((jumlah - prev_value) / prev_value * 100)|int %}
                                <span class="font-semibold {% if change >= 0 %}text-danger{% else %}text-success{% endif %}">
                                    {% if change >= 0 %}↑{% else %}↓{% endif %} {{ abs(change) }}%
                                </span>
                            {% else %}
                                <span class="text-secondary">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% set prev_value = jumlah %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Analisis 15: Rata-rata Penderita per Kabupaten/Kota -->
    <div class="card lg:col-span-2">
        <h3 class="chart-title">15. Rata-rata Penderita DM per Kabupaten/Kota</h3>
        <p class="text-secondary mb-4">Rata-rata jumlah penderita untuk setiap kabupaten/kota, berdasarkan semua tahun data.</p>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Kabupaten/Kota</th>
                        <th>Rata-rata Penderita</th>
                        <th>Kategori</th>
                    </tr>
                </thead>
                <tbody>
                    {% for kota, rata_rata in avg_per_kota.items() %}
                    <tr>
                        <td><a href="/detail/{{ kota }}" class="text-primary font-semibold hover:underline">{{ kota }}</a></td>
                        <td>{{ "{:,.0f}".format(rata_rata) }}</td>
                        <td>
                            {% if rata_rata >= 100000 %}
                                <span class="px-3 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">Tinggi</span>
                            {% elif rata_rata >= 50000 %}
                                <span class="px-3 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">Sedang</span>
                            {% else %}
                                <span class="px-3 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">Rendah</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Analisis 16a: Kabupaten/Kota Tertinggi -->
    <div class="card text-center">
        <h3 class="chart-title">16a. Penderita Tertinggi (Total)</h3>
        <p class="text-lg font-bold text-success">{{ tertinggi_kota }}</p>
        <p class="text-4xl font-extrabold text-success mb-1">{{ "{:,}".format(tertinggi_nilai) }}</p>
        <p class="text-secondary">Total Penderita (Semua Tahun)</p>
    </div>

    <!-- Analisis 16b: Kabupaten/Kota Terendah -->
    <div class="card text-center">
        <h3 class="chart-title">16b. Penderita Terendah (Total)</h3>
        <p class="text-lg font-bold text-warning">{{ terendah_kota }}</p>
        <p class="text-4xl font-extrabold text-warning mb-1">{{ "{:,}".format(terendah_nilai) }}</p>
        <p class="text-secondary">Total Penderita (Semua Tahun)</p>
    </div>

</div>

<!-- Info Alert -->
<div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg dark:bg-blue-900 dark:border-blue-800">
    <p class="text-sm text-blue-800 dark:text-blue-300">
        <strong>Catatan:</strong> Data analisis mencakup penderita diabetes melitus yang dilaporkan dari tahun {{ total_per_tahun.keys()|list|first|int }} hingga {{ total_per_tahun.keys()|list|last|int }}.
    </p>
</div>
{% endblock %}
